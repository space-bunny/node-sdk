<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SpaceBunny Web STOMP Over WebSocket example</title>
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/normalize.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>

  <body>

    <nav class="top-bar" data-topbar role="navigation">
      <ul class="title-area">
        <li class="name"><h1>SpaceBunny Web STOMP Over WebSocket example</h1></li>
      </ul>
    </nav>

    <div class="content large-12 small-12">
      <div class="large-6 small-6 columns">
        <h3>Received Messages</h3>
        <hr>
        <div id="messages"></div>
      </div>
      <div class="large-6 small-6 columns">
        <h3>Send a Message</h3>
        <hr>
        <span>
          <label for="channel-name">Channel name</label>
          <input type="text" name="channel-name" id="channel-name" value="">
        </span>
        <textarea id="message-text" rows="10"></textarea>
        <button type="button" name="send-button" id="send-button" class="small">Send</button>
        <div id="flash-messages"></div>
      </div>
    </div>

    <!-- Scripts placed at the end of the document so the pages load faster -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/foundation.min.js"></script>
    <!-- The SpaceBunny library -->
    <script src="spacebunny.js"></script>
    <script>
      $(document).ready(function() {
        var webStompClient = undefined;
        var flashMessage = function(message, type) {
          var content = "<div data-alert class='alert-box " + type + "'>" +
            "<div>" + message + "</div>" +
          "</div>";
          $('#flash-messages').append(content);
          $('.alert-box').fadeOut(3000);
        };
        var messageCallback = function(message) {
          $('#messages').append('<div>' + message.body + '</div>');
        };
        if(window.WebSocket) {
          webStompClient = new StompClient({ apiKey: 'your-api-key' });
          webStompClient.onReceive(messageCallback).then(function(res) {
            console.log(res);
          }).catch(function(reason) {
            console.error(reason);
          });

          $('#send-button').click(function() {
            var messageText = $('#message-text').val();
            var channel = $('#channel-name').val();
            if(channel === undefined) {
              flashMessage('Channel name required!', 'alert');
              return;
            }
            console.log(channel);
            webStompClient.publish(channel, messageText).then(function(res) {
              $('#message-text').val('');
              flashMessage('Message successfully sent!', 'success');
            }).catch(function(reason) {
              flashMessage(reason, 'alert');
            });
          });
        } else {
          $(body).html("\
              <h1>Get a new Web Browser!</h1>\
              <p>\
              Your browser does not support WebSockets. This example will not work properly.<br>\
              Please use a Web Browser with WebSockets support (WebKit or Google Chrome).\
              </p>\
          ");
        }
      });
    </script>
  </body>
</html>
