{"version":3,"sources":["spacebunny.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASA,IAAM,MAAM,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC,MAAM;;;AAAC;;;;;;IAS/C,UAAU;AACd,WADI,UAAU,CACF,IAAI,EAAE;0BADd,UAAU;;AAEZ,QAAI,CAAC,KAAK,GAAG,qBAAM,EAAE,EAAE,IAAI,CAAC,CAAC;AAC7B,QAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;AAC/C,QAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;AACjC,QAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;AACrC,QAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;AACrC,QAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC;AACnD,QAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;GACtC;;;;;;;;;AAAA;eATG,UAAU;;iCAkBD;AACX,UAAI,IAAI,CAAC,OAAO,KAAK,SAAS,IAAI,IAAI,CAAC,iBAAiB,KAAK,SAAS,EAAE;AACtE,YAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,uBAAuB,EAAE,CAAC,UAAU,CAAC;OACpE,MAAM,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,IAAI,IAAI,CAAC,iBAAiB,KAAK,SAAS,EAAE;AAC7E,cAAM,IAAI,4BAAiB,8BAA8B,CAAC,wBAAwB,CAAC,CAAC;OACrF;AACD,aAAO,IAAI,CAAC,iBAAiB,CAAC;KAC/B;;;;;;;;+BAKU;AACT,UAAI,CAAC,SAAS,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,IAAI,IAAI,CAAC,SAAS,CAAC;AAClE,aAAO,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,UAAS,GAAG,EAAE;AACtC,eAAO,GAAG,CAAC,IAAI,CAAC;OACjB,CAAC,CAAC;KACJ;;;;;;;;+BAKU;AACT,UAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC;AACpE,aAAO,IAAI,CAAC,SAAS,CAAC;KACvB;;;;;;;;;;;;;;;8CAYyB;AACxB,UAAI,IAAI,CAAC,gBAAgB,KAAK,SAAS,EAAE;AACvC,eAAO,IAAI,CAAC,gBAAgB,CAAC;OAC9B;;;AAAA,AAGD,UAAM,GAAG,QAAM,MAAM,CAAC,QAAQ,CAAC,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,WAAW,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,AAAE,CAAC;AAC1F,UAAI;AACF,YAAM,IAAI,GAAG,EAAE,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC;AACtD,YAAM,QAAQ,GAAG,2BAAQ,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;AAC3C,YAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC;AACvD,eAAO,IAAI,CAAC,gBAAgB,CAAC;OAC9B,CAAC,OAAO,EAAE,EAAE;AACX,cAAM,IAAI,4BAAiB,aAAa,CAAC,EAAE,CAAC,CAAC;OAC9C;KACF;;;wCAEmB,OAAO,EAAE;AAC3B,UAAI,mBAAmB,GAAG,OAAO,CAAC;AAClC,UAAI;AACF,2BAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;OAC/C,CAAC,OAAO,EAAE,EAAE;AACX,2BAAmB,GAAG,OAAO,CAAC;OAC/B;AACD,aAAO,mBAAmB,CAAC;KAC5B;;;SAhFG,UAAU;;;kBAoFD,UAAU","file":"spacebunny.js","sourcesContent":["/**\n * A module that exports the base SpaceBunny client\n * @module SpaceBunny\n */\n\n// Import some helpers modules\nimport merge from 'merge';\nimport request from 'sync-request';\n\nconst CONFIG = require('../config/constants').CONFIG;\n\n// Import Space Bunny errors\nimport SpaceBunnyErrors from './spacebunny_errors';\n\n/**\n * @constructor\n * @param {Object} opts - constructor options may contain api-key or connection options\n */\nclass SpaceBunny {\n  constructor(opts) {\n    this._opts = merge({}, opts);\n    this._connectionParams = this._opts.connection;\n    this._apiKey = this._opts.apiKey;\n    this._endPoint = this._opts.endPoint;\n    this._channels = this._opts.channels;\n    this._endPointConfigs = this._opts.endPointConfigs;\n    this._deviceId = this._opts.deviceId;\n  }\n\n  /**\n   * Check if api-key or connection parameters have already been passed\n   * If at least api-key is passed ask the endpoint for the configurations\n   * else if also connection parameters are not passed raise an exception\n   *\n   * @return an Object containing the connection parameters\n   */\n  connection() {\n    if (this._apiKey !== undefined && this._connectionParams === undefined) {\n      this._connectionParams = this._endPointConfigurations().connection;\n    } else if (this._apiKey === undefined && this._connectionParams === undefined) {\n      throw new SpaceBunnyErrors.ApiKeyOrConfigurationsRequired('Missing configurations');\n    }\n    return this._connectionParams;\n  }\n\n  /**\n   * @return all channels configured for the current device\n   */\n  channels() {\n    this._channels = this._endPointConfigs.channels || this._channels;\n    return this._channels.map(function(obj) {\n      return obj.name;\n    });\n  }\n\n  /**\n   * @return the device ID for the current device\n   */\n  deviceId() {\n    this._deviceId = this._deviceId || this._connectionParams.device_id;\n    return this._deviceId;\n  }\n\n  // ------------ PRIVATE METHODS -------------------\n\n  /**\n   * @private\n   * Return configs from the Space Bunny ndpoint\n   * it caches configurations so if you ask multiple\n   * time for configurations it makes only one request\n   *\n   * @return an Object containing endpoint configurations\n   */\n  _endPointConfigurations() {\n    if (this._endPointConfigs !== undefined) {\n      return this._endPointConfigs;\n    }\n\n    // Contact endpoint to retrieve configs\n    const uri = `${CONFIG.endpoint.url}${CONFIG.endpoint.api_version}${CONFIG.endpoint.path}`;\n    try {\n      const args = { headers: { 'Api-Key': this._apiKey } };\n      const response = request('GET', uri, args);\n      this._endPointConfigs = JSON.parse(response.getBody());\n      return this._endPointConfigs;\n    } catch (ex) {\n      throw new SpaceBunnyErrors.EndPointError(ex);\n    }\n  }\n\n  _encapsulateContent(content) {\n    let encapsulatedContent = content;\n    try {\n      encapsulatedContent = JSON.stringify(content);\n    } catch (ex) {\n      encapsulatedContent = content;\n    }\n    return encapsulatedContent;\n  }\n\n}\n\nexport default SpaceBunny;\n"],"sourceRoot":"/Users/gfoiani/Dev/work/JS/spacebunny-node/src"}